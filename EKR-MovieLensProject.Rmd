---
title: "MovieLens Dataset Analysis"
author: "E.K. RIHANI"
date: "07/10/2021"
output: pdf_document
---

```{r setup, include=FALSE}
load("EKR-MovieLens.RData")
knitr::opts_chunk$set(echo = TRUE)
```

# 1. Overview

## 1.1 Goal of the study
The aim of this study is to analyze a MovieLens dataset and try to create a model that can predict users' future preferences based on their current preferences, using data analysis and machine learning techniques. 

## 1.2 The dataset
The MovieLens datasets were created by the GroupLens research lab, from the Department of Computer Science and Engineering at the University of Minnesota.  
The dataset used for this study is the 10M dataset ([link](https://grouplens.org/datasets/movielens/10m/).
The 10M MovieLens dataset contains `r total_number_ratings` ratings for `r total_number_movies` movies, from `r total_number_users` users.  
The provided information inclue the user unique ID (`r column_names[1]`), the movie unique ID (`r column_names[2]`), the rating given by the user (`r column_names[3]`), the timestamp of the rating (`r column_names[4]`), the title of the movie (`r column_names[5]`) and its genre (`r column_names[6]`).

# 2. Methods and Analysis
This project will aim to progressively improve the accuracy of our predictions, step by step, by building a model based on the data of a training set (edx, 90% of the database, selected randomly) and then applying this model to predict the values of a validation set (10% of the database) and compare our prediction against the actual value.  
The metric used in this study to evaluate the accuracy of the prediction is the root-mean-squared error (RMSE), given by : $$\sqrt{ \frac{1}{N} \sum_{m,u}\left(\hat{y}_{m,u} -  y_{m,u}\right)^{2}}$$ With N the number of ratings, $\hat{y}_{m,u}$ the rating (for the movie m, by the user u) that is predicted by the model built with the training set and $y_{m,u}$ the actual rating of the testing set. The lower the RMSE, the more accurate the model.  

## 2.1 Multiple Linear Regression
The most basic models are Multiple Linear Regression, where $Y = \sum_{i=1}^{n} \beta + \alpha_{i}X_{i}$ with $Y$ our prediction, $\beta$ the intercept (mean rating), $\alpha_{1}$ to $\alpha_{n}$ the slopes and $X_{1}$ to $X_{n}$ the independent variables. This MLR model assumes that all variables are independent. In other words, this model assumes -- for example -- that users have absolutely no genre or era preferences. We can already see one of the limitations of the MLR models.  
The most basic linear model would be a naive model that calculates the mean rating of our testing set ($\beta = \hat{\mu}$) and then applies this rating to all predictions ($\mathbf{Y} = \beta + \varepsilon$), with no distinction between movies, genres, users... We can expect this model to give mediocre results.  
A more refined model includes the effect $\alpha_{m}$ of the movie m ($\mathbf{Y}_{m} = \beta + \alpha_{m} + \varepsilon_{m}$), with $\alpha_{m}$ a term that integrates the quality of each movie.  
We could actually use the linear model (*lm*) function on some high end computers with 64+ GB of RAM, but a much more elegant (and efficient) approach is to simply use $Y_{m} = \beta + \alpha_{m}X_{m}\Leftrightarrow{} \alpha_{m}X_{m} = Y_{m} - \beta$.  

In other words, we evaluate the movie effect by computing the difference between the mean rating of each movie and the average rating for all movies. This approach will be used on all our MLR models, with $$\alpha_{n+1}X_{n+1} = Y - \left(\beta + \sum_{i=1}^{n} \alpha_{i}X_{i}\right)$$ 
The movie-effect model can thus be improved to $\mathbf{Y}_{u,m} = \beta + \alpha_{m} + \alpha_{u} + \varepsilon_{u,m}$, by taking into account the average "generosity" of each user ($\alpha_{u}$).  

Our next step is to take into account the time variable. However, there are numerous time variable that could be taken into account : the year of the movie, the year of the rating, the time that is elapsed between the movie and the rating, or even the month or the day of the rating, if we want to take into account some seasonal or weekly effect.    

According to the MovieLens project, the rating timestamp is based on a 1970-01-01 origin, that can be used to converted the timestamp in a legible YYYY-MM-DD hh:mm:ss format (with the *as.POSIXct* function), that can be used to extract year and month of each rating. We then extract the year from the *title* in two steps : first we isolate all " (YYYY)" patterns (to take into account titles such as 2001 : A Space Odyssey...) and then extract the YYYY pattern from the previous one.



Section that explains the process and techniques used, including data cleaning, data exploration and visualization, insights gained, and your modeling approach


# 3. Results
## 3.1. MLR models
Our naive model, that uses the calculated mean rating ($\beta = \hat{\mu}$ = `r round(mean_rating,2)` stars) and applies it to all predicted ratings, no matter the movie or user, has -- as one can expect -- a pretty mediocre RMSE (RMSE$_{n}$= `r round(rmse_naive,3)`). 
The movie-effect model improves sensibly the precision of the prediction, with RMSE$_{m}$= `r round(rmse_movie,3)`. The movie/user-effect model, while still quite basic, further improves the result, with RMSE$_{m,u}$= `r round(rmse_movie_user,3)`

Section that presents the modeling results and discusses the model performance

# 4. Conclusion
Section that gives a brief summary of the report, its limitations and future work

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```
Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.